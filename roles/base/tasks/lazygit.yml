- name: Software | lazygit
  tags: lazygit
  block:
    - name: Check if lazygit is installed and get its version
      ansible.builtin.command:
        cmd: lazygit --version
      register: lazygit_version_check
      changed_when: false
      ignore_errors: true

    - name: Set lazygit installed flag
      ansible.builtin.set_fact:
        lazygit_installed: "{{ 'version' in lazygit_version_check.stdout }}"

    - name: Install lazygit
      when: not lazygit_installed
      ansible.builtin.shell: |
        VER=$(curl -I https://github.com/jesseduffield/lazygit/releases/latest/ | awk -F '/' '/^location/ {print  substr($NF, 1, length($NF)-1)}');
        wget https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${VER#v}_Linux_x86_64.tar.gz -O lazygit.tar.gz -O lazygit.tar.gz
        tar xf lazygit.tar.gz lazygit
        install lazygit /usr/local/bin
        rm lazygit lazygit.tar.gz
      args:
        chdir: /home/mose/Downloads/

# vim: ft=yaml.ansible
